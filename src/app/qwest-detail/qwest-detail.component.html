<nav *ngIf="this.pers && !this.srv.isDialogOpen" class="fixed-bottom">
  <div class="d-flex w-100 justify-content-end px-2 py-2">
    <!-- –ù–∞–∑–∞–¥ -->
    <button mat-icon-button (click)="goBack()" class="mx-2" *ngIf="!isEditMode">
      <img src="assets/icons/left.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'2.5em'}">
    </button>
    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
    <button mat-icon-button (click)="saveData()">
      <img src="assets/icons/edit.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'3em'}">
      <!-- <img *ngIf="isEditMode" src="assets/icons/create.png" class="img-fluid"
        [ngStyle]="{'object-fit': 'contain', 'height':'3em'}"> -->
    </button>
  </div>
</nav>

<!-- –ü—Ä–æ—Å–º–æ—Ç—Ä -->
<div class="container pt-2 pb-4" *ngIf="this.pers && qwest && !isEditMode">
  <div class="pb-4">
    <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ -->
    <app-image-component [(data)]="qwest.image"></app-image-component>

    <div class="progress position-relative" style="height: 32px;">
      <div class="progress-bar abprogr" role="progressbar" [style.width]="qwest.progressValue + '%'">
      </div>
      <div class="position-absolute w-100 px-1 text-center">
        <div class=" align-self-baseline">
          <h4>{{qwest.name}}</h4>
        </div>
      </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div *ngIf="qwest.descr" class="text-center pt-2 font-small  text-secondary">
      <i>
        {{qwest.descr}}
      </i>
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div div fxLayout="row" fxLayoutAlign="space-around center" class="mt-2" *ngIf="qwest.progressValue >= 100">
      <button mat-icon-button *ngIf="qwest.progressValue >= 100" (click)="doneQwest(qwest)">
        <img src="assets/icons/star.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'3em'}">
      </button>
      <!-- <button class="icon-small" mat-icon-button (click)="isFromDoneQwest=true; addTsk.show();">
          <img src="assets/icons/create.png" class="img-fluid">
        </button> -->
    </div>

    <!-- –ù–∞–≥—Ä–∞–¥—ã -->
    <ng-container *ngIf="qwest.rewards?.length > 0 || qwest.exp > 0">

      <div class="mt-2" style="padding-left: 10px;" fxFlexFill fxLayout="row wrap" fxLayoutAlign="center center"
        fxLayoutGap="10px grid">
        <div fxFlex="33" *ngIf="qwest.exp > 0">
          <div fxLayout="column" fxLayoutAlign="space-around center">
            <img src="assets/icons/–æ–ø—ã—Ç.png" class="img-fluid rounded"
              [ngStyle]="{'object-fit': 'contain', 'height': '50px'}">
            <div fxLayout="row" fxLayoutAlign="space-evenly center">
              <div>
                <small>+{{qwest.exp}} exp;</small>
              </div>
            </div>
          </div>
        </div>
        <div fxFlex="33" *ngFor="let rev of qwest.rewards">
          <div fxLayout="column" fxLayoutAlign="space-around center">
            <img src="{{rev.image}}" class="img-fluid rounded" [ngStyle]="{'object-fit': 'contain', 'height': '50px'}">
            <div fxLayout="row" fxLayoutAlign="space-evenly center">
              <div>
                <small>{{rev.name}}</small>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- <div fxLayout="row wrap" fxLayoutAlign="center center" class="pt-2">
        <div *ngIf="qwest.exp > 0">
          <span class="text-success">
            +{{qwest.exp}} exp;&nbsp;
          </span>
        </div>
        <div *ngFor="let inv of qwest.rewards">
          <span class="text-success">
            {{inv.name}};&nbsp;
          </span>
        </div>
      </div> -->
    </ng-container>

    <!-- –°–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ -->
    <div class="pt-2 text-center" *ngIf="linkAbs.length>0">
      <div *ngFor="let ab of linkAbs">
        <a skipLocationChange [routerLink]="['/pers/task', ab.id, false]">{{'üîó '+ab.name+' üîó'}}</a>
      </div>
    </div>

    <!-- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö -->
    <div class="pt-2 text-center" *ngIf="prevQwest">
      <a class="text-danger"
        [routerLink]="['/pers/qwest', prevQwest.id]">{{'"'+prevQwest.name+'" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω!'}}</a>
    </div>

    <!-- –°–ª–µ–¥—É—é—â–∏–π –∫–≤–µ—Å—Ç -->
    <div class="pt-2 text-center" *ngIf="nextQwests.length>0">
      <div *ngFor="let qw of nextQwests">
        <a skipLocationChange [routerLink]="['/pers/qwest', qw.id]">{{'üëâ '+qw.name+' üëà'}}</a>
      </div>
    </div>

    <div *ngIf="qwest.tasks.length>0" class="pt-2">
      <!-- –ó–∞–¥–∞—á–∏ -->
      <ul class="list-group p-0">
        <li *ngFor="let tsk of qwest.tasks" class="list-group-item px-0 py-1 border-0">
          <a class="align-self-center w-100" [routerLink]="['/pers/task', tsk.id, false]">
            <div class="d-flex">
              <div class="flex-grow-1 text-center align-self-baseline">
                <ng-container *ngIf="tsk.isDone; else elseTemplate">
                  <del>
                    <h6>{{tsk.name}}</h6>
                  </del>
                </ng-container>
                <ng-template #elseTemplate>
                  <h6>{{tsk.name}}</h6>
                </ng-template>
              </div>
            </div>
          </a>
        </li>
      </ul>
    </div>
  </div>
  <br>
  <br>
</div>
<!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
<div class="container pt-2 pb-4" *ngIf="this.pers && qwest && isEditMode">
  <div class="pb-4">
    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
    <app-image-component [(data)]="qwest.image" [isCanEdit]="true"></app-image-component>

    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
    <mat-form-field class="w-100">
      <input onfocus="this.select()" matInput autocomplete="off" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" [(ngModel)]="qwest.name"
        name="qwest.name">
    </mat-form-field>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <mat-form-field class="w-100">
      <textarea matInput autosize minRows='1' maxRows='5' useImportant='true' onfocus="this.select()" autocomplete="off"
        placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" [(ngModel)]="qwest.descr" name="descr"></textarea>
    </mat-form-field>

    <!-- –û–ø—ã—Ç -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="8px" *ngIf="!pers.isTES">
      <div style="width: 100%;">
        <mat-form-field class="w-100">
          <input matInput onfocus="this.select()" autocomplete="off" placeholder="–û–ø—ã—Ç" [(ngModel)]="qwest.exp"
            name="exp" [disabled]="qwest.hardnes != 0">
        </mat-form-field>
      </div>
      <div fxFlex="noshrink">
        <mat-chip-list [selectable]="true">
          <mat-chip (click)="setExp(1)" [selected]="qwest.hardnes==1" color="accent">–õ–µ–≥–∫–æ</mat-chip>
          <mat-chip (click)="setExp(2)" [selected]="qwest.hardnes==2" color="accent">–ù–æ—Ä–º</mat-chip>
          <mat-chip (click)="setExp(3)" [selected]="qwest.hardnes==3" color="accent">–°–ª–æ–∂–Ω–æ</mat-chip>
          <mat-chip (click)="setExp(0)" [selected]="qwest.hardnes==0" color="accent">–ü–æ–ª—å–∑.</mat-chip>
        </mat-chip-list>
      </div>
    </div>

    <!-- –ó–∞–¥–∞—á–∏ -->
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <h5>–ú–∏—Å—Å–∏–∏:</h5>
      <button class="icon-small" (click)="addTask();" mat-icon-button>
        <img src="assets/icons/create.png" class="img-fluid">
      </button>
    </div>
    <!-- –ó–∞–¥–∞—á–∏ -->
    <mat-list (cdkDropListDropped)="drop($event)" cdkDropList id="tsks" *ngIf="qwest.tasks.length>0">
      <div mat-list-item cdkDrag *ngFor="let tsk of qwest.tasks; let i = index">
        <div class="d-flex">
          <div class="flex-grow-1 align-self-center">
            <ng-container *ngIf="tsk.isDone; else elseTemplate">
              <del>
                <h6>{{tsk.name}}</h6>
              </del>
            </ng-container>
            <ng-template #elseTemplate>
              <h6>{{tsk.name}}</h6>
            </ng-template>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
            <button class="icon-small" (click)="delTask(tsk.id)" mat-icon-button>
              <img src="assets/icons/del.png" class="img-fluid">
            </button>
            <button class="icon-small" (click)="moveTaskToAnotherQwest(tsk)" mat-icon-button cdkDragHandle>
              <img src="assets/icons/up.png" class="img-fluid">
            </button>
            <button class="icon-small" mat-icon-button cdkDragHandle>
              <img src="assets/icons/right.png" class="img-fluid">
            </button>
          </div>
        </div>
      </div>
    </mat-list>

    <!-- –°–ª–µ–¥—É—é—â–∏–µ –∫–≤–µ—Å—Ç—ã -->
    <div fxLayout="row" fxLayoutAlign="space-between center" class="pt-2">
      <h5>–°–ª–µ–¥—É—é—â–∏–π –∫–≤–µ—Å—Ç:</h5>
      <div>
        <button class="icon-small" (click)="chooseNextQwest();" mat-icon-button *ngIf="nextQwests.length==0">
          <img src="assets/icons/edit.png" class="img-fluid">
        </button>

        <button class="icon-small" (click)="addNextQwest();" mat-icon-button *ngIf="nextQwests.length==0">
          <img src="assets/icons/create.png" class="img-fluid">
        </button>
      </div>
    </div>
    <mat-list *ngIf="nextQwests.length >0">
      <div mat-list-item *ngFor="let q of nextQwests; let i = index">
        <div class="d-flex">
          <div class="flex-grow-1 align-self-center">
            <h6>{{q.name}}</h6>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
            <button class="icon-small" (click)="delNextQwest(q.id)" mat-icon-button>
              <img src="assets/icons/del.png" class="img-fluid">
            </button>
          </div>
        </div>
      </div>
    </mat-list>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É -->
    <div fxLayout="row" fxLayoutAlign="space-between center" class="pt-2">
      <h5>–ù–∞–≥—Ä–∞–¥—ã:</h5>
      <button class="icon-small" (click)="addNewRevard(null)" mat-icon-button>
        <img src="assets/icons/create.png" class="img-fluid">
      </button>
    </div>
    <!-- –°–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥ -->
    <mat-list *ngIf="qwest.rewards.length > 0">
      <div mat-list-item *ngFor="let rev of qwest.rewards; let i = index">
        <div class="d-flex">
          <div class="flex-grow-1 align-self-center">
            {{rev.name}} <i>{{rev.descr}}</i>
          </div>
          <div class="d-flex">
            <!-- –£–¥–∞–ª–∏—Ç—å -->
            <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
              <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
              <button class="icon-small" (click)="addNewRevard(rev)" mat-icon-button>
                <img src="assets/icons/edit.png" class="img-fluid">
              </button>
              <button class="icon-small" (click)="delReward(rev.id)" mat-icon-button>
                <img src="assets/icons/del.png" class="img-fluid">
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-list>
    <!-- –ù–∞–≤—ã–∫ -->
    <div fxLayout="row" fxLayoutAlign="space-between center" class="pt-2">
      <h5>–ù–∞–≤—ã–∫:</h5>
      <button (click)="setAbil()" class="icon-small" mat-icon-button *ngIf="!qwest.abilitiId">
        <img src="assets/icons/edit.png" class="img-fluid">
      </button>
    </div>
    <!-- –°–≤—è–∑–∞–Ω–Ω—ã–π –Ω–∞–≤—ã–∫ -->
    <mat-list>
      <div mat-list-item *ngIf="qwestAbiliti">
        <div class="d-flex">
          <div class="flex-grow-1 align-self-center">
            {{qwestAbiliti.name}}
          </div>
          <div class="d-flex">
            <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
              <button class="icon-small" mat-icon-button (click)="delAb()">
                <img src="assets/icons/del.png" class="img-fluid">
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-list>
  </div>
  <br>
  <br>
</div>
