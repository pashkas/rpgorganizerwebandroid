<nav *ngIf="this.pers && !this.srv.isDialogOpen" class="fixed-bottom">
  <div class="d-flex w-100 justify-content-end px-2 py-2">
    <!-- –ù–∞–∑–∞–¥ -->
    <button mat-icon-button (click)="goBack()" class="mx-2" *ngIf="!isEditMode">
      <img src="assets/icons/left.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'2.5em'}">
    </button>
    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
    <button mat-icon-button (click)="saveData()">
      <img src="assets/icons/edit.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'3em'}">
      <!-- <img *ngIf="isEditMode" src="assets/icons/create.png" class="img-fluid"
        [ngStyle]="{'object-fit': 'contain', 'height':'3em'}"> -->
    </button>
  </div>
</nav>
<!-- –ü—Ä–æ—Å–º–æ—Ç—Ä -->
<div class="container pt-2 pb-4" *ngIf="this.pers && tsk && !isEditMode">
  <form class="pb-4">
    <app-image-component *ngIf="tskAbility && tskAbility?.image" [(data)]="tskAbility.image"></app-image-component>
    <app-image-component *ngIf="!tskAbility" [data]="'assets/img/'+ tsk.imageLvl + '/'+tsk.image+'.jpg'">
    </app-image-component>
    <div class="progress position-relative" style="height: 32px;" *ngIf="tskAbility">
      <div class="progress-bar abprogr" role="progressbar" [style.width]="tskAbility.progressValue + '%'">
      </div>
      <div class="d-flex position-absolute w-100 px-1">
        <div class="flex-grow-1 text-left align-self-baseline">
          <h4>{{tsk| abHardness}}</h4>
        </div>
        <div class="text-right align-self-baseline">
          <h4>{{tskAbility.rang.name}}</h4>
        </div>
      </div>
    </div>

    <div class="w-100 px-0 text-center" *ngIf="!tskAbility">
      <h4>{{tsk.name}}</h4>
    </div>

    <br *ngIf="tskAbility">
    <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è, –ø–æ–≤—Ç–æ—Ä -->
    <div fxLayout="row" fxLayoutAlign="space-between center" class="px-1" *ngIf="tskAbility">
      <ng-container *ngIf="tskCharact">
        <a [routerLink]="['/pers/characteristic', tskCharact.id]">{{tskCharact.name}}</a>
      </ng-container>

      <div>
        {{tsk.date|datestring}}
        ({{tsk.requrense|titlecase }})
      </div>

      <!-- <div>
        {{tsk.timeVal | timeVal}}
      </div> -->

      <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="5px">
        <button *ngIf="tsk.mayUp&& this.pers.ON>0" class="icon-small" mat-icon-button (click)="upAbil();">
          <img src="assets/icons/up.png" class="img-fluid">
        </button>
        <button class="icon-small" *ngIf="tsk.value > 0 && !pers.isTES" mat-icon-button (click)="downAbil();">
          <img src="assets/icons/down.png" class="img-fluid">
        </button>
        <span *ngIf="tsk.requrense != '–Ω–µ—Ç'">
          <img src="assets/icons/diamond.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'1.5em'}">
          <span [ngClass]="{'text-success': pers.ON>0, 'text-danger': pers.ON<0}">
            {{this.pers.ON}}
          </span>
        </span>
      </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="text-center pt-2 font-small text-secondary" *ngIf="tsk.descr">
      <i>
        {{tsk.descr}}
      </i>
    </div>

    <!-- –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç—ã -->
    <div class="pt-2 text-center" *ngIf="linkQwests.length>0">
      <div *ngFor="let qw of linkQwests">
        <a skipLocationChange [routerLink]="['/pers/qwest', qw.id]">{{'üîó '+qw.name+' üîó'}}</a>
      </div>
    </div>

    <app-req-show *ngIf="tskAbility" [reqvirements]="tsk.reqvirements"></app-req-show>

    <button *ngIf="tsk.isStateRefresh" class="my-1" style="width: 100%;" color="accent" mat-stroked-button
      (click)="refrCounter()">
      <mat-icon>refresh</mat-icon>
    </button>

    <ng-container *ngIf="!tskAbility && tsk.states.length>0">
      <mat-list (cdkDropListDropped)="drop($event)" cdkDropList id="states" *ngIf="tsk.states.length > 0">
        <div mat-list-item *ngFor="let st of tsk.states; let i = index">
          <ng-container *ngIf="st.isDone">
            <del>
              <div class="text-center">
                {{st.name}}
              </div>
            </del>
          </ng-container>
          <ng-container *ngIf="!st.isDone">
            <div class="text-center">
              {{st.name}}
            </div>
          </ng-container>
        </div>
      </mat-list>
    </ng-container>
    <ng-container *ngIf="!pers.isTES">
      <br>
      <ng-container *ngFor="let st of tsk.statesDescr; let i = index;">
        <div *ngIf="i!=0 && st &&(!tsk.isPerk || (tsk.isPerk && i==10))" class="text-center px-0 py-1 border-0"
          [ngClass]="{'bg-success': i==tsk.value && tskAbility.isOpen}">
          <b *ngIf="!tsk.isPerk">{{i}}<ng-container *ngIf="st&&!tsk.isPerk">: </ng-container></b>{{st}}
        </div>
      </ng-container>
    </ng-container>
    <div *ngIf="pers.isTES && tsk.curLvlDescr" class="text-center px-0 py-1 border-0">
      <br>
      <div class="border">
        {{tsk.curLvlDescr}}
      </div>
    </div>
  </form>
  <br>
  <br>
</div>
<!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="container pt-2 pb-4" *ngIf="this.pers && tsk && isEditMode">
  <form class="pb-4">
    <app-image-component *ngIf="tskAbility && tskAbility?.image" [(data)]="tskAbility.image" [isCanEdit]="true">
    </app-image-component>
    <app-image-component *ngIf="!tskAbility" [data]="'assets/img/'+ tsk.imageLvl + '/'+tsk.image+'.jpg'">
    </app-image-component>
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
    <div fxLayout="row" xLayoutAlign="none center" fxLayoutGap='15px'>
      <mat-form-field>
        <input onfocus="this.select()" matInput autocomplete="off" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" [(ngModel)]="tsk.name"
          name="tsk.name">
      </mat-form-field>

    </div>
    <mat-form-field *ngIf="tskCharact">
      <input class="pointer" (click)="changeCharact()" matInput readonly placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞" name="tsk.charact"
        value="{{tskCharact.name}}">
    </mat-form-field>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div fxLayout="row" fxLayoutAlign="space-around center" fxLayoutGap="10px">
      <mat-form-field>
        <textarea matInput autosize minRows='1' maxRows='5' useImportant='true' onfocus="this.select()"
          autocomplete="off" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" [(ngModel)]="tsk.descr" name="tsk.descr"></textarea>
      </mat-form-field>
    </div>

    <!-- –î–∞—Ç–∞, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px">
      <mat-chip-list fxFlex="noshrink" [selectable]="false">
        <mat-chip (click)="qwickSetDate('today')" color="accent">–°–µ–≥–æ–¥–Ω—è</mat-chip>
        <mat-chip (click)="qwickSetDate('tomorrow')" color="accent">&nbsp;–ó–∞–≤—Ç—Ä–∞&nbsp;</mat-chip>
      </mat-chip-list>

      <mat-form-field>
        <input [readonly]="true" matInput autocomplete="off" placeholder="–î–∞—Ç–∞" [ngModel]="tsk.date" name="tsk.date"
          (ngModelChange)="onTskDateChange($event)" [owlDateTimeTrigger]="dt1" [owlDateTime]="dt1">
        <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
      </mat-form-field>

      <ng-container *ngIf="tsk.requrense != '–Ω–µ—Ç'">
        <!-- –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ -->
        <mat-form-field>
          <mat-label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</mat-label>
          <mat-select [(ngModel)]="tsk.requrense" name="tsk.requrense">
            <mat-option *ngFor="let req of requrenses" [value]="req">
              {{req}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <!-- –í—Ä–µ–º—è -->
        <!-- <mat-form-field>
          <input placeholder="–í—Ä–µ–º—è" matInput [ngxTimepicker]="picker" [format]="24" [(ngModel)]="tsk.time"
            name="tasktime" readonly>
          <ngx-material-timepicker #picker></ngx-material-timepicker>
        </mat-form-field> -->

        <!-- <mat-form-field>
          <mat-label>–í—Ä–µ–º—è</mat-label>
          <mat-select [(ngModel)]="tsk.timeVal" name="tsk.timeVal">
            <mat-option *ngFor="let req of times" [value]="req">
              {{req|timeVal}}
            </mat-option>
          </mat-select>
        </mat-form-field> -->
      </ng-container>
    </div>

    <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ -->
    <div fxLayout="row" fxLayoutGap="0.3em" fxLayoutAlign="center center" *ngIf="tsk.requrense == '–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏'">
      <div *ngFor="let wd of weekDays">
        <ng-container>
          <mat-chip (click)="setWeekDays(wd)" [selected]="tsk.tskWeekDays.includes(wd)" color="accent">
            {{'    ' + wd + '    '}}
          </mat-chip>
        </ng-container>
      </div>
    </div>


    <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
    <ng-container *ngIf="tsk.requrense != '–Ω–µ—Ç'">
      <div fxLayout="row" fxLayoutAlign="center center" class="pb-3">
        <mat-chip-list selectable multiple>
          <mat-chip (click)="tsk.isPerk=!tsk.isPerk" [selected]="tsk.isPerk" color="accent">
            &nbsp;&nbsp;–ü–µ—Ä–∫?&nbsp;&nbsp;
          </mat-chip>

          <!-- <ng-container>
            <mat-divider vertical class="vertdiv"></mat-divider>
            <mat-chip *ngIf="!pers.isTES" (click)="tsk.hardnes=0.5" [selected]="tsk.hardnes==0.5" color="accent">–ª–µ–≥–∫–æ
            </mat-chip>
            <mat-chip (click)="tsk.hardnes=1" [selected]="tsk.hardnes==1" color="accent">–Ω–æ—Ä–º</mat-chip>
            <mat-chip (click)="tsk.hardnes=2" [selected]="tsk.hardnes==2" color="accent">—Å–ª–æ–∂</mat-chip>
            <mat-chip *ngIf="pers.isTES" (click)="tsk.hardnes=3" [selected]="tsk.hardnes==3" color="accent">–æ—á. —Å–ª–æ–∂
            </mat-chip>
          </ng-container> -->

          <!-- <mat-divider vertical class="vertdiv"></mat-divider> -->

          <mat-chip [selected]="tsk.isStatePlusTitle" color="accent"
            (click)="tsk.isStatePlusTitle=!tsk.isStatePlusTitle">
            –ù–∞–∑–≤–∞–Ω–∏–µ</mat-chip>
          <mat-chip [selected]="tsk.isStateInTitle" color="accent" (click)="tsk.isStateInTitle=!tsk.isStateInTitle">
            –ó–∞–≥–ª–æ–≤–æ–∫
          </mat-chip>
          <mat-chip color="accent" (click)="setSumStates()" [selected]="tsk.isSumStates">&nbsp;‚àë&nbsp;</mat-chip>
          <mat-chip [selected]="tsk.isStateRefresh" color="accent" (click)="tsk.isStateRefresh=!tsk.isStateRefresh">
            &nbsp;‚ü≥&nbsp;
          </mat-chip>
        </mat-chip-list>
      </div>
    </ng-container>

    <ng-container *ngIf="tsk.requrense != '–Ω–µ—Ç'">
      <!-- –¢–∞–π–º–µ—Ä, —Å—á–µ—Ç—á–∏–∫ -->
      <div fxLayoutGap="8px" fxLayout="row" fxLayoutAlign="space-between center">
        <mat-form-field fxFlex>
          <input matInput autocomplete="off" onfocus="this.select()" placeholder="–¶–µ–ª—å" [(ngModel)]="tsk.aimTimer"
            name="tsk.aimTimer">
        </mat-form-field>

        <mat-chip-list [selectable]="true">
          <mat-chip (click)="tsk.aimUnit = '–ß–∞—Å–æ–≤'" [selected]="tsk.aimUnit == '–ß–∞—Å–æ–≤'" color="accent">–ß–∞—Å–æ–≤</mat-chip>
          <mat-chip (click)="tsk.aimUnit = '–ú–∏–Ω—É—Ç'" [selected]="tsk.aimUnit == '–ú–∏–Ω—É—Ç'" color="accent">–ú–∏–Ω—É—Ç</mat-chip>
          <mat-chip (click)="tsk.aimUnit = '–°–µ–∫—É–Ω–¥'" [selected]="tsk.aimUnit == '–°–µ–∫—É–Ω–¥'" color="accent">–°–µ–∫—É–Ω–¥
          </mat-chip>
          <mat-chip (click)="tsk.aimUnit = '–†–∞–∑'" [selected]="tsk.aimUnit == '–†–∞–∑'" color="accent">–†–∞–∑</mat-chip>
        </mat-chip-list>
        <!-- <mat-form-field>
          <input matInput autocomplete="off" onfocus="this.select()" placeholder="–†–∞–∑" [(ngModel)]="tsk.aimCounter"
            name="tsk.aimCounter">
        </mat-form-field> -->

      </div>
    </ng-container>


    <!-- –°–æ—Å—Ç–æ—è–Ω–∏—è -->
    <!-- <h5>–°–æ—Å—Ç–æ—è–Ω–∏—è:</h5> -->
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <ng-container *ngIf="tsk.requrense != '–Ω–µ—Ç'">
        <h5>–ü–æ–¥–∑–∞–¥–∞—á–∏:</h5>
      </ng-container>
      <ng-container *ngIf="tsk.requrense === '–Ω–µ—Ç'">
        <h5>–ü–æ–¥–∑–∞–¥–∞—á–∏:</h5>
      </ng-container>
      <button class="icon-small" (click)="addStateToTask();" mat-icon-button>
        <img src="assets/icons/create.png" class="img-fluid">
      </button>
    </div>

    <mat-list (cdkDropListDropped)="drop($event)" cdkDropList id="states" *ngIf="tsk.states.length > 0">
      <div mat-list-item cdkDrag *ngFor="let st of tsk.states; let i = index">
        <div class="d-flex">
          <div class="flex-grow-1 align-self-center">
            <a class="text-primary">
              <ng-container *ngIf="tsk.requrense != '–Ω–µ—Ç' || st.isDone == false">
                {{st.name}}
              </ng-container>
              <ng-container *ngIf="tsk.requrense === '–Ω–µ—Ç' && st.isDone == true">
                <del>
                  {{st.name}}
                </del>
              </ng-container>
            </a>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">

            <button class="icon-small" (click)="addStateToTask(st)" mat-icon-button>
              <img src="assets/icons/edit.png" class="img-fluid">
            </button>

            <button class="icon-small" (click)="delState(st.id)" mat-icon-button>
              <img src="assets/icons/del.png" class="img-fluid">
            </button>

            <button class="icon-small" mat-icon-button cdkDragHandle>
              <img src="assets/icons/right.png" class="img-fluid">
            </button>
          </div>
        </div>
      </div>
    </mat-list>

    <app-req-edit *ngIf="tskAbility" [reqvirements]="tsk.reqvirements" (reqvirementsChange)="tsk.reqvirements=$event">
    </app-req-edit>

  </form>
  <br>
  <br>
</div>
